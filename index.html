<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>SPEI Ops - Speikito v31 (Gemini 2.5)</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial; height:100vh; margin:0; overflow:hidden; background:#f1f5f9}
    .layout{display:flex; height:100%}
    .sidebar{width:280px; background:#0f172a; color:#94a3b8; display:flex; flex-direction:column; border-right:1px solid #1e293b}
    .sidebar .hdr{padding:18px 18px; border-bottom:1px solid #1e293b; display:flex; align-items:center; gap:10px; color:#fff; font-weight:800}
    .nav{flex:1; overflow:auto; padding:10px 0}
    .sec{font-size:10px; font-weight:900; text-transform:uppercase; color:#475569; padding:14px 18px 8px; letter-spacing:.08em}
    .item{padding:12px 18px; cursor:pointer; display:flex; gap:10px; align-items:center; font-size:13px; font-weight:600; border-left:3px solid transparent}
    .item:hover{background:#1e293b; color:#fff}
    .item.active{background:#1e293b; color:#fff; border-left-color:#3b82f6}
    .main{flex:1; display:flex; flex-direction:column; background:#fff; overflow:hidden}
    .top{height:64px; border-bottom:1px solid #e2e8f0; display:flex; align-items:center; justify-content:space-between; padding:0 18px}
    .view{flex:1; display:none; overflow:auto}
    .view.active{display:flex}
    .chat{flex:1; display:flex; flex-direction:column; background:#f8fafc}
    .chatbox{flex:1; overflow:auto; padding:18px}
    .inputbar{border-top:1px solid #e2e8f0; background:#fff; padding:14px 18px}
    .bubble{max-width:85%; padding:12px 14px; border-radius:16px; font-size:13px; line-height:1.6; box-shadow:0 2px 4px rgba(0,0,0,.05)}
    .u{background:#2563eb; color:#fff; border-bottom-right-radius:0; margin-left:auto}
    .b{background:#fff; border:1px solid #e2e8f0; color:#0f172a; border-bottom-left-radius:0; width:100%}
    .toast{position:fixed; top:18px; left:50%; transform:translateX(-50%); z-index:9999; padding:10px 14px; border-radius:999px; font-weight:800; font-size:12px; opacity:0; pointer-events:none; transition:.25s}
    .toast.show{opacity:1; top:26px}
    .overlay{position:fixed; inset:0; background:rgba(15,23,42,.92); backdrop-filter:blur(3px); display:flex; align-items:center; justify-content:center; z-index:9998}
    .hidden{display:none!important}
    .card{background:#fff; width:min(720px,92vw); border-radius:16px; overflow:hidden; box-shadow:0 25px 50px -12px rgba(0,0,0,.25)}
  </style>
</head>
<body>

<div id="toast" class="toast bg-emerald-600 text-white">Listo</div>

<!-- Loading -->
<div id="loading" class="overlay">
  <div class="text-center">
    <div class="w-14 h-14 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
    <p class="text-xs font-extrabold uppercase tracking-widest text-slate-300">Iniciando…</p>
  </div>
</div>

<!-- Upload modal -->
<div id="uploadModal" class="overlay hidden">
  <div class="card">
    <div class="p-4 border-b bg-slate-50 flex items-center justify-between">
      <div>
        <div class="text-sm font-extrabold text-slate-900">Carga masiva</div>
        <div class="text-[11px] text-slate-500 font-bold">Certificados / Directorio / Manuales / Reglas</div>
      </div>
      <button class="text-slate-500 hover:text-red-600" onclick="closeUpload()"><i class="fas fa-times"></i></button>
    </div>
    <div class="p-5">
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <label class="text-[11px] font-extrabold uppercase text-slate-500">Tipo</label>
          <select id="bulkType" class="mt-1 w-full border rounded-lg px-3 py-2 font-bold text-slate-800">
            <option value="REGLA_SPEI">Normativa SPEI</option>
            <option value="CERTIFICADO">Certificados</option>
            <option value="EXTENSION">Directorio</option>
            <option value="MANUAL">Manuales</option>
          </select>
          <p class="mt-2 text-[11px] text-slate-500 leading-relaxed">
            Sube <b>.xlsx</b> o <b>.csv</b>. Mantiene los campos actuales; sólo necesitas columnas con nombres razonables
            (ej: <i>Regla/Capítulo/Texto_literal/Tema_operativo</i> o <i>NUMERO/NEGOCIO/ESTATUS/FIN</i>, etc.).
          </p>
          <button class="mt-3 text-xs font-extrabold text-blue-700 hover:text-blue-900" onclick="downloadLayout()">
            <i class="fas fa-download mr-2"></i>Descargar layout de ejemplo
          </button>
        </div>

        <div class="border-2 border-dashed rounded-xl p-6 text-center bg-slate-50 hover:bg-slate-100 cursor-pointer"
             onclick="document.getElementById('bulkFile').click()">
          <i class="fas fa-upload text-3xl text-slate-500 mb-3"></i>
          <div class="text-sm font-extrabold text-slate-800">Seleccionar archivo</div>
          <div class="text-[11px] font-bold text-slate-500 mt-1">.xlsx / .csv</div>
          <input id="bulkFile" type="file" accept=".xlsx,.csv" class="hidden" onchange="handleBulkUpload(this)">
        </div>
      </div>
    </div>
    <div class="p-4 border-t bg-slate-50 flex justify-end">
      <button class="text-xs font-extrabold text-slate-500 hover:text-slate-800" onclick="closeUpload()">Cerrar</button>
    </div>
  </div>
</div>

<div class="layout">
  <aside class="sidebar">
    <div class="hdr"><i class="fas fa-cat text-blue-500"></i> SPEI Ops</div>
    <div class="nav">
      <div class="sec">Operación</div>
      <div class="item active" id="navChat" onclick="nav('chat')"><i class="fas fa-comments w-5"></i> Speikito</div>

      <div class="sec">Gestión</div>
      <div class="item" id="navAll" onclick="nav('all')"><i class="fas fa-globe w-5"></i> Ver todo</div>
      <div class="item" id="navRules" onclick="nav('rules')"><i class="fas fa-balance-scale w-5"></i> Normativa</div>
      <div class="item" id="navCert" onclick="nav('cert')"><i class="fas fa-certificate w-5"></i> Certificados</div>
      <div class="item" id="navExt" onclick="nav('ext')"><i class="fas fa-address-book w-5"></i> Directorio</div>
      <div class="item" id="navDocs" onclick="nav('docs')"><i class="fas fa-book w-5"></i> Manuales</div>
    </div>

    <div class="p-4 border-t border-slate-800">
      <button class="w-full bg-slate-800 hover:bg-slate-700 text-slate-200 py-2 rounded-lg text-xs font-extrabold"
              onclick="openUpload()">
        <i class="fas fa-upload mr-2"></i> Carga masiva
      </button>
      <p class="mt-3 text-[10px] text-slate-500 font-extrabold uppercase tracking-wider">v31 • Gemini 2.5</p>
    </div>
  </aside>

  <main class="main">
    <div class="top">
      <div class="font-extrabold text-slate-900" id="title">Chat</div>
      <div class="flex gap-2 items-center">
        <span id="aiStatus" class="text-[11px] font-extrabold text-slate-500">IA: verificando…</span>
      </div>
    </div>

    <section class="view active" id="viewChat">
      <div class="chat">
        <div class="chatbox" id="chatbox">
          <div class="bubble b">
            <div class="font-extrabold mb-1"><i class="fas fa-cat text-blue-600 mr-2"></i>Speikito</div>
            <div class="text-slate-700">
              Pregúntame algo. Si tengo contexto cargado (reglas/manuales), lo usaré. Si no, te contesto en general y te lo marco.
            </div>
          </div>
        </div>
        <div class="inputbar">
          <form id="chatForm" class="flex gap-2">
            <input id="q" class="flex-1 bg-slate-50 border border-slate-200 rounded-2xl px-5 py-4 text-sm font-extrabold text-slate-700 outline-none focus:border-blue-500"
                   placeholder="Escribe tu pregunta…" autocomplete="off" />
            <button class="w-14 bg-blue-600 text-white rounded-2xl flex items-center justify-center shadow-lg hover:bg-blue-700 active:scale-95">
              <i class="fas fa-paper-plane"></i>
            </button>
          </form>
        </div>
      </div>
    </section>

    <section class="view" id="viewList" style="flex-direction:column">
      <div class="p-4 border-b flex gap-2 items-center bg-slate-50">
        <input id="search" class="flex-1 border rounded-lg px-3 py-2 font-bold text-slate-800" placeholder="Filtrar…" oninput="renderList()" />
        <button class="w-10 h-10 bg-white border rounded-lg text-slate-500 hover:text-blue-700" onclick="renderList()"><i class="fas fa-sync-alt"></i></button>
      </div>
      <div id="list" class="p-4 overflow-auto" style="flex:1">
        <div class="text-slate-400 italic">Sin datos.</div>
      </div>
    </section>
  </main>
</div>

<script>
  // ====== Datos (en esta versión simple: en memoria) ======
  // Si tú ya lo tienes conectado a Firestore en tu proyecto anterior, puedes volver a integrar;
  // lo importante aquí es que la IA NO dependa de que exista una "regla exacta".
  let knowledgeBase = []; // {contentType,title,content,regla,capitulo,tema,keywords,...}

  function toast(msg, err=false){
    const t=document.getElementById('toast');
    t.textContent=msg;
    t.className = "toast show " + (err ? "bg-red-600 text-white" : "bg-emerald-600 text-white");
    setTimeout(()=>t.classList.remove('show'), 2600);
  }

  // ====== NAV ======
  let currentView = 'chat';
  let currentType = 'ALL';
  function setActive(id){
    document.querySelectorAll('.item').forEach(x=>x.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }
  function nav(v){
    currentView = v;
    const chat = document.getElementById('viewChat');
    const list = document.getElementById('viewList');
    if(v==='chat'){
      setActive('navChat');
      document.getElementById('title').textContent = 'Chat';
      chat.classList.add('active'); list.classList.remove('active');
      return;
    }
    chat.classList.remove('active'); list.classList.add('active');
    if(v==='all'){ setActive('navAll'); currentType='ALL'; document.getElementById('title').textContent='Base completa'; }
    if(v==='rules'){ setActive('navRules'); currentType='REGLA_SPEI'; document.getElementById('title').textContent='Normativa'; }
    if(v==='cert'){ setActive('navCert'); currentType='CERTIFICADO'; document.getElementById('title').textContent='Certificados'; }
    if(v==='ext'){ setActive('navExt'); currentType='EXTENSION'; document.getElementById('title').textContent='Directorio'; }
    if(v==='docs'){ setActive('navDocs'); currentType='MANUAL'; document.getElementById('title').textContent='Manuales'; }
    renderList();
  }

  // ====== LISTA ======
  function renderList(){
    const term = (document.getElementById('search')?.value || "").trim().toLowerCase();
    const data = currentType==='ALL' ? knowledgeBase : knowledgeBase.filter(x=>x.contentType===currentType);
    const filtered = term ? data.filter(x=>{
      const t = ((x.title||"") + " " + (x.content||"") + " " + (x.tema||"") + " " + (x.keywords||"")).toLowerCase();
      return t.includes(term);
    }) : data;

    const el = document.getElementById('list');
    if(!filtered.length){
      el.innerHTML = "<div class='text-slate-400 italic'>Sin registros.</div>";
      return;
    }
    el.innerHTML = filtered.map(x=>`
      <div class="bg-white border rounded-xl p-4 mb-3 shadow-sm">
        <div class="text-[11px] font-extrabold text-slate-500 uppercase">${x.contentType}</div>
        <div class="font-extrabold text-slate-900 mt-1">${escapeHtml(x.title||"(Sin título)")}</div>
        <div class="text-sm text-slate-700 mt-1 whitespace-pre-wrap">${escapeHtml((x.content||"").slice(0,400))}${(x.content||"").length>400?"…":""}</div>
      </div>
    `).join("");
  }

  // ====== Upload ======
  function openUpload(){ document.getElementById('uploadModal').classList.remove('hidden'); }
  function closeUpload(){ document.getElementById('uploadModal').classList.add('hidden'); document.getElementById('bulkFile').value=""; }

  function downloadLayout(){
    const csv = [
      "TIPO,TITULO,CONTENIDO,NUMERO,NEGOCIO,ENTORNO,ESTATUS,INICIO,FIN,EXTENSION,NOMBRE,AREA,REGLA,CAPITULO,TEXTO_LITERAL,TEMA_OPERATIVO,PALABRAS_CLAVE",
      "REGLA_SPEI,,,,,,,,,,,,17a,Cap 3,El participante deberá...,Devoluciones,"devolucion, retorno, rechazo"",
      "CERTIFICADO,,,9A3F,SPEI,PRODUCCION,VIGENTE,2024-01-01,2026-12-31,,,,,,,",
      "EXTENSION,,,,,,,,,5522,Juan Perez,Soporte,,,,,,",
      "MANUAL,Procedimiento devoluciones,"Paso 1...\nPaso 2...",,,,,,,,,,,,,"
    ].join("\n");
    const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "layout_speikito.csv";
    a.click();
  }

  function handleBulkUpload(input){
    const f = input.files?.[0];
    if(!f) return;

    const forceType = document.getElementById('bulkType').value;

    const reader = new FileReader();
    reader.onload = (e) => {
      let rows = [];
      const isXlsx = f.name.toLowerCase().endsWith(".xlsx");
      if(isXlsx){
        const wb = XLSX.read(new Uint8Array(e.target.result), {type:"array"});
        rows = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], {defval:""});
      }else{
        const text = e.target.result;
        rows = csvToJson(text);
      }

      const mapped = rows.map(r => mapRowToEntry(r, forceType));
      // En tu versión Firestore: aquí harías batch.set(...) conservando campos.
      knowledgeBase = knowledgeBase.concat(mapped);

      toast(`Importados: ${mapped.length}`);
      closeUpload();
      if(currentView!=='chat') renderList();
    };

    if(f.name.toLowerCase().endsWith(".xlsx")) reader.readAsArrayBuffer(f);
    else reader.readAsText(f, "utf-8");
  }

  function mapRowToEntry(row, forceType){
    const pick = (...keys) => {
      for(const k of keys){
        if(row[k] !== undefined && row[k] !== null && String(row[k]).trim() !== "") return String(row[k]).trim();
      }
      return "";
    };

    // si trae TIPO en el archivo, lo respeta; si no, usa el selector
    const tipo = pick("TIPO","Tipo","tipo") || forceType;

    if(tipo === "REGLA_SPEI"){
      const regla = pick("Regla","REGLA","REGLA_SPEI","REGLA_APLICABLE","REGLA_ID","REGLA_NUM","REGLA_NO","REGLA_N");
      const capitulo = pick("Capítulo","CAPITULO","Capitulo","CAPÍTULO");
      const literal = pick("Texto_literal","TEXTO_LITERAL","TEXTO","CONTENIDO","Texto","LITERAL");
      const tema = pick("Tema_operativo","TEMA_OPERATIVO","TEMA","TITULO","TÍTULO","Tema");
      const keywords = pick("Palabras_clave","PALABRAS_CLAVE","KEYWORDS","Keywords");
      return { contentType:"REGLA_SPEI", regla, capitulo, tema, keywords, title: `Regla ${regla||"(s/n)"}`, content: literal };
    }

    if(tipo === "CERTIFICADO"){
      const num = pick("NUMERO","CERTIFICADO","Últimos 4","ULTIMOS4","ULTIMOS_4","c-num");
      const negocio = pick("NEGOCIO","Negocio","c-neg");
      const entorno = pick("ENTORNO","Entorno","c-env");
      const estatus = pick("ESTATUS","Estatus","c-stat");
      const ini = pick("INICIO","Vigencia Inicio","INICIO_VIGENCIA","c-ini");
      const fin = pick("FIN","Vigencia Fin","FIN_VIGENCIA","c-fin");
      return { contentType:"CERTIFICADO", num, negocio, entorno, estatus, vigenciaIni: ini, vigenciaFin: fin, title: `CERT ${num||"(s/n)"}`, content: `${negocio||""} | ${estatus||""}`.trim() };
    }

    if(tipo === "EXTENSION"){
      const ext = pick("EXTENSION","EXT","e-num");
      const nombre = pick("NOMBRE","Nombre","e-nom");
      const area = pick("AREA","Área","e-area");
      return { contentType:"EXTENSION", ext, nombre, area, title:`EXT ${ext||"(s/n)"}`, content:`${nombre||""} - ${area||""}`.trim() };
    }

    // MANUAL (default)
    const title = pick("TITULO","Título","Title","d-title") || "Importado";
    const content = pick("CONTENIDO","Contenido","Content","d-content");
    return { contentType:"MANUAL", title, content };
  }

  function csvToJson(text){
    const lines = text.split(/\r?\n/).filter(Boolean);
    if(!lines.length) return [];
    const headers = splitCsvLine(lines[0]).map(h=>h.trim());
    return lines.slice(1).map(line=>{
      const cols = splitCsvLine(line);
      const obj = {};
      headers.forEach((h,i)=>obj[h]=cols[i] ?? "");
      return obj;
    });
  }

  function splitCsvLine(line){
    // CSV simple con comillas dobles
    const out = [];
    let cur = "", inQ = false;
    for(let i=0;i<line.length;i++){
      const ch = line[i];
      if(ch === '"' && line[i+1] === '"'){ cur += '"'; i++; continue; }
      if(ch === '"'){ inQ = !inQ; continue; }
      if(ch === ',' && !inQ){ out.push(cur); cur=""; continue; }
      cur += ch;
    }
    out.push(cur);
    return out;
  }

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // ====== IA (Gemini 2.5) ======
  async function askGemini(userQuestion){
    // Contexto (si existe): prioriza reglas + manuales + lo que haya
    const ctxRules = knowledgeBase.filter(x=>x.contentType==="REGLA_SPEI").slice(0, 12);
    const ctxDocs  = knowledgeBase.filter(x=>x.contentType==="MANUAL").slice(0, 6);

    const ctx = [
      ctxRules.length ? ("NORMATIVA CARGADA:\n" + ctxRules.map(r=>`- Regla ${r.regla||""} | ${r.capitulo||""} | ${r.tema||""}\n  ${r.content||""}`).join("\n")) : "",
      ctxDocs.length ? ("MANUALES CARGADOS (extracto):\n" + ctxDocs.map(d=>`- ${d.title}\n  ${String(d.content||"").slice(0,250)}`).join("\n")) : ""
    ].filter(Boolean).join("\n\n");

    const systemHint = ctx
      ? `Usa el CONTEXTO de forma preferente. Si el contexto no contiene la respuesta, dilo y responde con mejores prácticas generales. No inventes citas normativas.`
      : `No hay contexto cargado. Responde de forma general y aclara que es una respuesta general (no normativa).`;

    const prompt = `${systemHint}\n\n${ctx ? "CONTEXTO:\n"+ctx+"\n\n" : ""}PREGUNTA:\n${userQuestion}\n\nDevuelve SOLO texto claro (sin JSON, sin markdown de bloques).`;

    const res = await fetch("/api/gemini", {
      method:"POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ prompt })
    });

    const data = await res.json().catch(()=> ({}));
    if(!res.ok){
      const msg = data?.error || data?.message || "No se pudo consultar la IA";
      throw new Error(`Error API (${res.status}): ${msg}`);
    }
    return data?.text || "Sin respuesta de IA.";
  }

  // ====== Chat UI ======
  function addBubble(html, isUser){
    const wrap = document.createElement("div");
    wrap.className = "w-full flex mb-3 " + (isUser ? "justify-end" : "justify-start");
    const b = document.createElement("div");
    b.className = "bubble " + (isUser ? "u" : "b");
    b.innerHTML = html;
    wrap.appendChild(b);
    const box = document.getElementById("chatbox");
    box.appendChild(wrap);
    box.scrollTop = box.scrollHeight;
    return b;
  }

  document.getElementById("chatForm").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const q = document.getElementById("q").value.trim();
    if(!q) return;
    document.getElementById("q").value = "";
    addBubble(escapeHtml(q), true);

    const typing = addBubble("<span class='text-slate-500 font-extrabold text-xs'>Speikito está pensando…</span>", false);

    try{
      const ans = await askGemini(q);
      typing.innerHTML = escapeHtml(ans).replaceAll("\n","<br>");
    }catch(err){
      typing.innerHTML = `<span class="text-red-600 font-extrabold">${escapeHtml(err.message)}</span>`;
    }
  });

  // ====== Healthcheck IA ======
  async function ping(){
    try{
      const r = await fetch("/api/gemini", {method:"POST", headers:{"Content-Type":"application/json"}, body: JSON.stringify({prompt:"Responde con OK"})});
      const j = await r.json().catch(()=> ({}));
      document.getElementById("aiStatus").textContent = r.ok ? "IA: activa" : "IA: error";
      if(!r.ok) document.getElementById("aiStatus").textContent += " (revisa GEMINI_API_KEY / modelo)";
    }catch(e){
      document.getElementById("aiStatus").textContent = "IA: no disponible";
    }
  }

  window.addEventListener("load", async ()=>{
    document.getElementById("loading").classList.add("hidden");
    await ping();
  });
</script>
</body>
</html>


--- FILE: api/gemini.js ---
// /api/gemini.js  (Vercel Serverless Function - CommonJS)
// Requisitos en Vercel:
// - Agrega GEMINI_API_KEY en Project Settings -> Environment Variables
// - (Opcional) GEMINI_MODEL = gemini-2.5-flash (default) o gemini-2.5-pro
//
// Esta función devuelve: { text: "..." }

module.exports = async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  try {
    const { prompt, model } = req.body || {};
    if (!prompt || typeof prompt !== "string") {
      return res.status(400).json({ error: "Falta prompt" });
    }

    const apiKey = process.env.GEMINI_API_KEY;
    if (!apiKey) {
      return res.status(500).json({ error: "No está configurada GEMINI_API_KEY en Vercel" });
    }

    // Gemini 2.5 (default)
    const usedModel = (model || process.env.GEMINI_MODEL || "gemini-2.5-flash").trim();

    const url =
      "https://generativelanguage.googleapis.com/v1beta/models/" +
      encodeURIComponent(usedModel) +
      ":generateContent";

    const resp = await fetch(url, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-goog-api-key": apiKey,
      },
      body: JSON.stringify({
        contents: [{ parts: [{ text: prompt }] }],
        // Puedes ajustar temperatura si quieres respuestas más determinísticas:
        // generationConfig: { temperature: 0.3 }
      }),
    });

    const data = await resp.json();

    if (!resp.ok) {
      const msg = data?.error?.message || "Error llamando a Gemini";
      return res.status(resp.status).json({ error: msg, raw: data });
    }

    const text =
      data?.candidates?.[0]?.content?.parts?.map((p) => p.text).join("") ||
      "";

    return res.status(200).json({ text, raw: data });
  } catch (e) {
    return res.status(500).json({ error: "Error interno", detail: String(e?.message || e) });
  }
};


--- FILE: package.json ---
{
  "name": "speikito",
  "private": true
}


--- FILE: README.txt ---
Estructura recomendada (Vercel):
/
  index.html
  /api
    gemini.js

1) En Vercel > Project Settings > Environment Variables:
   - GEMINI_API_KEY = (tu key)
   - (opcional) GEMINI_MODEL = gemini-2.5-flash  (o gemini-2.5-pro)

2) Redeploy (Vercel se actualiza solo al hacer push).

Si te da 405 Method not allowed:
- Estás pegándole a /api/gemini con GET desde el navegador. Debe ser POST.
- En esta UI ya está como POST.

Si te da 404 de modelo:
- Cambia GEMINI_MODEL a gemini-2.5-flash o gemini-2.5-pro.
